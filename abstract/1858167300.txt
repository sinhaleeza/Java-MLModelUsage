In the process of web service composition, the check and prevention of semantic incompatibility is one of the most important issues. In this paper, a controlled Petri net (CtlPN)-based model for web service composition is proposed. Meanwhile, the optimal controller is constructed, such that the appropriate vectors of controllable place and arc are appended in the key transition which can lead to deadlock states. In addition, for the semantic incompatibility case, a policy based on appending optimal controller is presented. It is proved that our policy can be a good solution. Finally, the proposed controller is transformed as the activity of BPEL.