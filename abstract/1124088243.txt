We focus on the problems of cooperative virtual machine management of cloud users in a smart grid environment. In such an environment, the cloud users can cooperate to share the available computing resources in private cloud and public cloud to reduce the total cost. To achieve an optimal and fair solution, we develop the framework composed of the virtual machine allocation, cost management, and cooperation formation models. The problem is challenging due to the uncertainties (e.g., uncertain power price and unpredictable users' demand). Therefore, for the virtual machine allocation, we develop the stochastic programming model to obtain the optimal solutions of virtual machines to be hosted in the local data center, to be hosted on the public cloud servers, or to be migrated to the data centers of other cooperative cloud users. Then, among cooperative cloud users, the cost management is formulated as the coalitional game whose fair share of the total cost is obtained as the Shapley value. Next, given that the cloud users are rational, we formulate the cooperation formation as the network formation game to analyze the stability of the cooperation. In the experiment, we evaluate our proposed framework with real trace data. The results clearly show that the cooperative virtual machine management can achieve the minimum total cost of cloud users compared with expected value and worst case formulations.