With the increase of the energy consumption associated with IT systems and services, energy efficiency is becoming a critical concern in the design, development and management of web service systems. In this paper, both the web service selection and server dynamic speed scaling are optimized by maximizing the quality of service (QoS) revenue and minimizing energy costs. Stochastic models of web service systems are proposed, and quantitative analysis of the performance and energy consumption is carried out. In addition, the service selection and speed scaling problem is formulated as a Markov Decision Process (MDP) problem, and algorithms to solve it are introduced. Furthermore, we propose an agent-based optimization framework and design related algorithms to solve the service selection and speed scaling problem in large-scale web service systems. Finally, their effectiveness is validated by simulation results.