To enforce reliability of composite Web Services at run-time, this paper proposes a transaction management model based on Compensation Planning Graph for Web Service composition. First, a web service composition model with transactional properties is introduced. Second, in order to handle transaction when exceptions are occurred, compensation dependency relationships and Compensation Planning Graph is introduced, and an algorithm of automatic generation of compensation dependency relationships and transaction handling based on CPG is proposed. Finally, evaluation methods of QoS of web services and user satisfaction of transaction handling are given. During the execution of composite web services, this approach can guarantee compensation achieving through forward- or backward-compensation. In addition, in this model, a novel concept named Transfer Service is proposed to solve the problem that there are no compensation services or unsuccessful retriable services after many retry times. This model and method can improve self-adjustability and stability of composite services in the course of deployment and execution. Simulations prove that this approach can efficiently guarantee the reliability of composite services at run-time.