In the last few years, the Internet of Things (IoT) has obtained rapid development. The amount of devices and sensors that are connected to the Internet has increased significantly. On the other hand, the environmental monitoring and control becomes more and more important in several fields. Since devices and sensors may be produced by different manufacturers, it is necessary to find a solution for shielding the heterogeneity. What's more, vast amount of data will bring the performance issue. In this paper, we design and implement a middleware for environmental monitoring and control. The middleware system is hierarchically distributed. Data from heterogeneous devices are converted into unified virtual entities to shield the heterogeneity. The middleware provides service invocation for the upper application and supports dynamic perception and discovery of devices. Through the registration module, the middleware can be easily upgraded, and will not affect the underlying devices and the upper application. We design several mechanisms to process a mass of data. The paper presents experimental results to illustrate the good performance of the middleware system. Generally speaking, every detail of our design is for the actual situation of environmental monitoring and control.