Resilience against unexpected server failures is a key desirable function of quality-assured service systems. A good capacity planning decision should cost-effectively allocate spare capacity for exploiting failure resilience mechanisms. In this paper, we propose an optimal capacity planning algorithm for server-cluster based service systems,particularly the ones that provision composite services via several servers. The algorithm takes into account two commonly used failure resilience mechanisms: intra-cluster load-controlling and inter-cluster failover. The goal is to minimize the resource cost while assuring service levels on the end-to-end throughput and response time of provisioned composite services under normal conditions and server failure conditions. We illustrate that the stated goal can be formalized as a capacity planning optimization problem and can be solved mathematically via convex analysis and linear optimization techniques. We also quantitatively demonstrate that the proposed algorithm can find the min-cost capacity planning solution that assures the end-to-end performance of managed composite services for both the non-failure case and the common server failure cases in a three-tier web-based service system with multiple server clusters. To the best of our knowledge, this paper presents the first research effort in optimizing the cost of supporting failure resilience for quality-assured composite services.