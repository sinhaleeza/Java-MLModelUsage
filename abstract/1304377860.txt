Indoor localization service based on magnetic field attracts increasing attention in the field of mobile computing in recent years. However, most of existing indoor localization methods based on magnetic field usually require the pedestrians to be equipped with a unified localization device, or take the magnetic value as the only characteristic of an indoor fingerprint map. Neither of these two kinds of methods could make sure that the indoor localization is ubiquitous, accurate and robust. Therefore, we propose a novel indoor hybrid fingerprint map and a robust Extended Particle Swarm Optimization Algorithm (EPSO). The proposed indoor hybrid fingerprint map is characterized by the variation trend of magnetic value and visible light intensity, which is suitable for most current smartphones that are usually integrated with the electronic compass and the light sensor. EPSO can correct not only the "data drifting" problem of sensors but also the logic error of localization called "wall crash". In addition, EPSO is still able to provide a high and robust localization accuracy when the attitude of smartphone is changed. Finally, we conduct a series of experiments and the experimental results show that EPSO is robust and it can achieve an accuracy within 1.7 m in the case of 80% localization errors.