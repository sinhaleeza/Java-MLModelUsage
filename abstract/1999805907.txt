With the emergence of big data computing and analysis, cloud computing services become more and more popular, which has recently drawn researchers' great attentions to develop various new applications and mechanisms. In this paper, we consider the on-demand mechanism design in the infrastructure as a service (IaaS), including resource allocation and pricing issues under dynamic scenarios. Most of existing works on mechanism design assumed static and independent individual utility, while the cloud computing services are provided in a dynamic environment. To solve such problems, we start with analyzing the Google cluster-usage dataset to draw the statistical and stochastic characteristics of the IaaS consumers and providers. Based on the characteristics mined from real data, we propose a stochastic matching algorithm with Markov Decision Process (MDP), which aims at optimizing the long-term system efficiency, with its online version using Q-learning method to address the imperfect model estimation problem. We further design an efficient (EF), incentive compatible (IC), individual rational (IR) auction mechanism, which is an extension of traditional Vickrey-Clarke-Groves (VCG) mechanism. The proposed mechanism is studied under two application scenario: quality sensitive services, where unilateral MDP-VCG auction is implemented; and quality insensitive services, where MDP-VCG double auction is implemented. To verify the performance of our proposed mechanism, we conduct experiment using the Google dataset and show that the proposed MDP-based VCG auction mechanism can achieve EF, IC and IR properties simultaneously.